<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Josiah King &amp; Ben Matthews" />


<title>Exploring reconvictions in Scotland with Das Gupta</title>

<script src="data:application/x-javascript;base64,JChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXsKICAgIGlmICh0eXBlb2YgJCgnW2RhdGEtdG9nZ2xlPSJ0b29sdGlwIl0nKS50b29sdGlwID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgJCgnW2RhdGEtdG9nZ2xlPSJ0b29sdGlwIl0nKS50b29sdGlwKCk7CiAgICB9CiAgICBpZiAoJCgnW2RhdGEtdG9nZ2xlPSJwb3BvdmVyIl0nKS5wb3BvdmVyID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgJCgnW2RhdGEtdG9nZ2xlPSJwb3BvdmVyIl0nKS5wb3BvdmVyKCk7CiAgICB9Cn0pOwo="></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Exploring reconvictions in Scotland with Das Gupta</h1>
<h4 class="author">Josiah King &amp; Ben Matthews</h4>



<p>Standardization and decomposition are widely used analytic techniques to adjust for the impact of compositional factors on rates.</p>
<ul>
<li><p><em>Standardization</em>: Shows us what a rate would have been under different scenarios - for example, if there was no change in the age/sex structure of the population, or if there was no change in the prevalence of the event we are studying (e.g. reconviction).</p></li>
<li><p><em>Decomposition</em>: Gives us the percentage of the difference in rates between two years attributable to each of the factors we have included in the standardization.</p></li>
</ul>
<p>The <em>DasGuptR</em> package provides an implementation of Prithwith Das Gupta’s specification of these two techniques<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>.</p>
<div id="reconviction-rates" class="section level1">
<h1>Reconviction rates</h1>
<p>Scottish Government publish an annual statistical bulletin on the <a href="https://www.gov.scot/publications/reconviction-rates-scotland-2016-17-offender-cohort/">Reconviction Rates in Scotland</a>. For the cohort of people convicted in a given year, it provides information on the numbers of reconvictions they have received. The headline figure in this bulletin is the <em>reconviction rate</em>, which is simply the percentage of offenders who have been reconvicted within the follow-up of one year. The bulletin published in 2019 showed that Scotland’s reconviction rate has fallen steadily over the last fifteen years.</p>
<p>Rates such as this measure the prevalence of some event (i.e., prevalence of reconviction), but often also reflect underlying changes in, for example, the age/sex structure of the population. For example, if women over 40, who have a low average reconviction rate, made up a larger proportion of all people convicted then the overall reconviction rate would go down, even if the reconviction rate itself did not change for any age group.</p>
<p>Similarly, Scottish Government’s old measure of the <em>average number of reconvictions per offender</em> <a href="https://www2.gov.scot/About/Performance/scotPerforms/indicator/reconviction">(previously a National Indicator)</a> might reflect changes in:</p>
<ul>
<li>the proportion of offenders who are reconvicted<br />
</li>
<li>the frequency with which reconvicted offenders are reconvicted<br />
</li>
<li>the age-sex structure of the convicted population</li>
</ul>
<div id="reconviction-data" class="section level2">
<h2>Reconviction data</h2>
<p>DasGuptR package provides data on the reconviction rates in Scotland between 2004 and 2016, by age group and sex.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(DasGuptR)
<span class="kw">data</span>(reconv)
<span class="kw">str</span>(reconv)</code></pre></div>
<pre><code>## Classes 'tbl_df', 'tbl' and 'data.frame':    130 obs. of  7 variables:
##  $ year                : int  2004 2004 2004 2004 2004 2004 2004 2004 2004 2004 ...
##  $ Gender              : chr  &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; ...
##  $ Age                 : chr  &quot;21 to 25&quot; &quot;26 to 30&quot; &quot;31 to 40&quot; &quot;over 40&quot; ...
##  $ convicted_population: num  49351 49351 49351 49351 49351 ...
##  $ offenders           : num  1650 1268 2238 1198 1488 ...
##  $ reconvicted         : num  576 420 558 212 424 ...
##  $ reconvictions       : num  1145 786 963 361 858 ...</code></pre>
</div>
</div>
<div id="rate-as-a-productfunction-of-factors" class="section level1">
<h1>Rate as a product/function of factors</h1>
<p>Our starting point is our crude rate. In the example provided here, our <em>overall reconviction rate</em> is simply the average of the reconviction rates for each age-sex group, <em>weighted by the size of the group</em>.</p>
<div id="rate-of-reconviction" class="section level3">
<h3>rate of reconviction</h3>
<p>We can write the <em>reconviction rate</em> as is a function of 2 factors<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>.<br />
The overall reconviction rate can be written as</p>
<p><span class="math inline">\(\Sigma(A \times B)\)</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(A\)</span> = the proportion of offenders in a given age-sex group who are reconvicted<br />
</li>
<li><span class="math inline">\(B\)</span> = the proportion of total offenders who are in that age-sex group</li>
</ul>
The table below (2004 reconviction rates) shows how the sex-specific reconviction rates (prop_reconvicted) multiplied by the proportion of the population that group makes up (prop_offenders) sum to the overall reconviction rate.<br />

<table>
<thead>
<tr>
<th style="text-align:left;">
Gender
</th>
<th style="text-align:right;">
offenders
</th>
<th style="text-align:right;">
reconvicted
</th>
<th style="text-align:right;">
convicted_population
</th>
<th style="text-align:right;">
prop_reconvicted
</th>
<th style="text-align:right;">
prop_offenders
</th>
<th style="text-align:right;">
crude_rate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Female
</td>
<td style="text-align:right;">
7842
</td>
<td style="text-align:right;">
2190
</td>
<td style="text-align:right;">
49351
</td>
<td style="text-align:right;">
0.28
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;font-weight: bold;">
0.04
</td>
</tr>
<tr>
<td style="text-align:left;">
Male
</td>
<td style="text-align:right;">
41509
</td>
<td style="text-align:right;">
13787
</td>
<td style="text-align:right;">
49351
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:right;font-weight: bold;">
0.28
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #555555 !important;">
All
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;">
49351
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;">
15977
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;">
49351
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;">
0.32
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;">
1.00
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;font-weight: bold;">
0.32
</td>
</tr>
</tbody>
</table>
</div>
<div id="average-number-of-reconvictions-per-offender" class="section level3">
<h3>average number of reconvictions per offender</h3>
<p>Likewise, the <em>average number of reconvictions per offender</em> in a given year can likewise be written as:</p>
<p><span class="math inline">\(\Sigma(A \times B \times C)\)</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(A\)</span> = the frequency with which reconvicted offenders are reconvicted<br />
</li>
<li><span class="math inline">\(B\)</span> = the proportion of offenders in a given age-sex group who are reconvicted<br />
</li>
<li><span class="math inline">\(C\)</span> = the proportion of total offenders who are in that age-sex group</li>
</ul>
<p>Again, the sex-specific crude rates in the table below (freq_reconvicted <span class="math inline">\(\times\)</span> prop_reconvicted <span class="math inline">\(\times\)</span> prop_offenders) sum to the overall average number of reconvictions per offender. Note that this measure is more easily calculated as simply the <em>number of reconvictions</em> / <em>number of offenders</em>, but by separating out into two factors of prevalence ( <em>number reconvicted</em> / <em>number of offenders</em> ) and frequency ( <em>number of reconvictions</em> / <em>number reconvicted</em> ) we can investigate the extent to which changes in the <em>average number of reconvictions per offender</em> are due to a) the percentages of offenders who are reconvicted, or b) the frequency with which reconvicted offenders are reconvicted.</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
Gender
</th>
<th style="text-align:right;">
reconvicted
</th>
<th style="text-align:right;">
reconvictions
</th>
<th style="text-align:right;">
freq_reconvicted
</th>
<th style="text-align:right;">
prop_reconvicted
</th>
<th style="text-align:right;">
prop_offenders
</th>
<th style="text-align:right;">
crude_rate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Female
</td>
<td style="text-align:right;">
2190
</td>
<td style="text-align:right;">
4113
</td>
<td style="text-align:right;">
1.88
</td>
<td style="text-align:right;font-weight: bold;">
0.28
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
0.08
</td>
</tr>
<tr>
<td style="text-align:left;">
Male
</td>
<td style="text-align:right;">
13787
</td>
<td style="text-align:right;">
25992
</td>
<td style="text-align:right;">
1.89
</td>
<td style="text-align:right;font-weight: bold;">
0.33
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:right;">
0.53
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #555555 !important;">
All
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;">
15977
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;">
30105
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;">
1.88
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;font-weight: bold;">
0.32
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;">
1.00
</td>
<td style="text-align:right;font-weight: bold;color: white !important;background-color: #555555 !important;">
0.61
</td>
</tr>
</tbody>
</table>
</div>
<div id="rates-as-a-function-f-of-factors" class="section level2">
<h2>Rates as a function F of factors</h2>
<p>While both of the reconviction measures above can be taken as a product of different factors, other rates can often be a specific function F of factors.</p>
<p>A simple example:</p>
<p>Crude rate of natural increase = <span class="math inline">\(A-B\)</span></p>
<ul>
<li><span class="math inline">\(A\)</span> = crude birth rate<br />
</li>
<li><span class="math inline">\(B\)</span> = crude death rate</li>
</ul>
<p>A more complex example:</p>
<p>Crude birth rate per 1,000 population = <span class="math inline">\([AB + C(1-B)]D\)</span></p>
<ul>
<li><span class="math inline">\(A\)</span> = marital births per 1,000 married women aged 15 to 49<br />
</li>
<li><span class="math inline">\(B\)</span> = proportion of married women among all women aged 15 to 49<br />
</li>
<li><span class="math inline">\(C\)</span> = Nonmarital births per 1,000 unmarried women aged 15 to 49<br />
</li>
<li><span class="math inline">\(D\)</span> = proportion of women aged 15 to 49 in the total population</li>
</ul>
</div>
</div>
<div id="the-das-gupta-method" class="section level1">
<h1>The Das Gupta Method</h1>
<p>Das Gupta’s methodologies of standardisation and decomposition are explained in full in his 1993 book <em><a href="https://babel.hathitrust.org/cgi/pt?id=osu.32437011198450">Standardization and decomposition of rates: A user’s manual</a></em></p>
<div id="p-factors-2-populations" class="section level2">
<h2>P factors, 2 populations</h2>
<p>The essence of Das Gupta’s method is that, given a set of P factors and 2 populations, one can calculate the rates adjusted for each combination of P-1 factors (see Das Gupta 1993, p.32, equation 3.54).<br />
We can interpret the P-<span class="math inline">\(\alpha\)</span> adjusted rate as ‘what the crude rate would look like if only <span class="math inline">\(\alpha\)</span> had changed (all else being equal)’.</p>
<p>Neatly, the crude rate can be decomposed into Das Gupta’s adjusted rates such that changes in the P-<span class="math inline">\(\alpha\)</span> adjusted rate are proportional to changes in crude rates.<br />
For instance, if the crude rate decreases by 1.2, and the P-<span class="math inline">\(\alpha\)</span> adjusted rate decreases by .6, we can say that 50% of the change is crude rate is attributable to changes in <span class="math inline">\(\alpha\)</span><a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>.<br />
The change in P-<span class="math inline">\(\alpha\)</span> adjusted rate is known as a <em>decomposition effect</em>, in this case the <span class="math inline">\(\alpha\)</span> <em>effect</em>.</p>
</div>
<div id="p-factors-n-populations" class="section level2">
<h2>P factors, N populations</h2>
<p>Das Gupta provides a further process for standardizing the rates and decomposition effects across N populations, which can be applied to populations at given years for analysis of time series.<br />
This process involves first calculating the P-1 adjusted rates and decompositions effects for all possible pairwise comparisons of populations, and then standardizing these across the N populations (see Das Gupta 1993, p.106, equations 6.11 and 6.12) to obtain a consistent set of rates and effects, such that</p>
<ul>
<li>there is only one P-<span class="math inline">\(\alpha\)</span> adjusted rate per population (as opposed to N-1)<br />
</li>
<li>the <span class="math inline">\(\alpha\)</span> <em>effect</em> corresponding to populations 1 and 2 and the <span class="math inline">\(\alpha\)</span> <em>effect</em> for populations 2 and 3 now sum to the <span class="math inline">\(\alpha\)</span> <em>effect</em> corresponding to populations 1 and 3.</li>
</ul>
</div>
</div>
<div id="the-dasguptr-package" class="section level1">
<h1>The DasGuptR package</h1>
<p>Standardization and decomposition via Das Gupta’s formulae can be achieved in R via the <strong>DasGupt_Npop()</strong> function.</p>
<p>To begin, we firstly require some data.</p>
<p>A column is required specifying the population (e.g., <em>year</em> in the reconv data), and a column for each of the factors we wish to include in the decomposition.<br />
For example, if we were interested in decomposing the <em>average number of reconvictions per offender</em> into the prevalence and frequency of reconviction, then the following (in red) would suffice:</p>
<table>
<thead>
<tr>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; color: grey70 !important;padding-right: 4px; padding-left: 4px; background-color: white !important;" colspan="1">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Population
</div>
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; color: grey70 !important;padding-right: 4px; padding-left: 4px; background-color: white !important;" colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Decomposition Factors
</div>
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; color: grey70 !important;padding-right: 4px; padding-left: 4px; background-color: white !important;" colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Raw numbers
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
year
</th>
<th style="text-align:left;">
prevalence
</th>
<th style="text-align:left;">
frequency
</th>
<th style="text-align:left;">
offenders
</th>
<th style="text-align:left;">
reconvicted
</th>
<th style="text-align:left;">
reconvictions
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2004
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.324
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.884
</td>
<td style="text-align:left;color: grey10 !important;">
49351
</td>
<td style="text-align:left;color: grey10 !important;">
15977
</td>
<td style="text-align:left;color: grey10 !important;">
30105
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2005
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.324
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.849
</td>
<td style="text-align:left;color: grey10 !important;">
50343
</td>
<td style="text-align:left;color: grey10 !important;">
16333
</td>
<td style="text-align:left;color: grey10 !important;">
30202
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2006
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.324
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.842
</td>
<td style="text-align:left;color: grey10 !important;">
53305
</td>
<td style="text-align:left;color: grey10 !important;">
17272
</td>
<td style="text-align:left;color: grey10 !important;">
31816
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2007
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.312
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.834
</td>
<td style="text-align:left;color: grey10 !important;">
53044
</td>
<td style="text-align:left;color: grey10 !important;">
16572
</td>
<td style="text-align:left;color: grey10 !important;">
30385
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2008
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.315
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.896
</td>
<td style="text-align:left;color: grey10 !important;">
49665
</td>
<td style="text-align:left;color: grey10 !important;">
15653
</td>
<td style="text-align:left;color: grey10 !important;">
29682
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2009
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.306
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.831
</td>
<td style="text-align:left;color: grey10 !important;">
47416
</td>
<td style="text-align:left;color: grey10 !important;">
14491
</td>
<td style="text-align:left;color: grey10 !important;">
26539
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
…
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
…
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
…
</td>
<td style="text-align:left;color: grey10 !important;">
…
</td>
<td style="text-align:left;color: grey10 !important;">
…
</td>
<td style="text-align:left;color: grey10 !important;">
…
</td>
</tr>
</tbody>
</table>
<p>If we are also interested in including the underlying structure of the population (e.g. age and sex sub-groups) in the decomposition, then each row should identify the sub-group via a set of id variables (i.e., age and sex), with a column specifying the proportion of the population made up by that sub-group (the <em>pop_str</em> variable below):</p>
<table>
<thead>
<tr>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; color: grey70 !important;padding-right: 4px; padding-left: 4px; background-color: white !important;" colspan="1">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Population
</div>
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; color: grey70 !important;padding-right: 4px; padding-left: 4px; background-color: white !important;" colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
ID variables
</div>
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; color: grey70 !important;padding-right: 4px; padding-left: 4px; background-color: white !important;" colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Decomposition factors
</div>
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; color: grey70 !important;padding-right: 4px; padding-left: 4px; background-color: white !important;" colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Raw numbers
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
year
</th>
<th style="text-align:left;">
Gender
</th>
<th style="text-align:left;">
Age
</th>
<th style="text-align:left;">
prevalence
</th>
<th style="text-align:left;">
frequency
</th>
<th style="text-align:left;">
pop_str
</th>
<th style="text-align:left;">
offenders
</th>
<th style="text-align:left;">
reconvicted
</th>
<th style="text-align:left;">
reconvictions
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2004
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
Female
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
21 to 25
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.349
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.988
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.033
</td>
<td style="text-align:left;color: grey10 !important;">
1650
</td>
<td style="text-align:left;color: grey10 !important;">
576
</td>
<td style="text-align:left;color: grey10 !important;">
1145
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2004
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
Female
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
26 to 30
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.331
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.871
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.026
</td>
<td style="text-align:left;color: grey10 !important;">
1268
</td>
<td style="text-align:left;color: grey10 !important;">
420
</td>
<td style="text-align:left;color: grey10 !important;">
786
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2004
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
Female
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
31 to 40
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.249
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.726
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.045
</td>
<td style="text-align:left;color: grey10 !important;">
2238
</td>
<td style="text-align:left;color: grey10 !important;">
558
</td>
<td style="text-align:left;color: grey10 !important;">
963
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2004
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
Female
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
over 40
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.177
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.703
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.024
</td>
<td style="text-align:left;color: grey10 !important;">
1198
</td>
<td style="text-align:left;color: grey10 !important;">
212
</td>
<td style="text-align:left;color: grey10 !important;">
361
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2004
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
Female
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
under 21
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.285
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2.024
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.03
</td>
<td style="text-align:left;color: grey10 !important;">
1488
</td>
<td style="text-align:left;color: grey10 !important;">
424
</td>
<td style="text-align:left;color: grey10 !important;">
858
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
2004
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
Male
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
21 to 25
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.367
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
1.927
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
0.181
</td>
<td style="text-align:left;color: grey10 !important;">
8941
</td>
<td style="text-align:left;color: grey10 !important;">
3285
</td>
<td style="text-align:left;color: grey10 !important;">
6330
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
…
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
…
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
…
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
…
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
…
</td>
<td style="text-align:left;font-weight: bold;color: white !important;background-color: #D7261E !important;">
…
</td>
<td style="text-align:left;color: grey10 !important;">
…
</td>
<td style="text-align:left;color: grey10 !important;">
…
</td>
<td style="text-align:left;color: grey10 !important;">
…
</td>
</tr>
</tbody>
</table>
<p>The second thing we require is the function F by which the rate is to be calculated from the decomposition factors.<br />
In our two examples of the <em>reconviction rate</em> and <em>average number of reconvictions per offender</em>, rates are simply the product of factors.</p>
<ul>
<li>reconviction rate = prevalence <span class="math inline">\(\times\)</span> pop_str<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a><br />
</li>
<li>avg number reconvs per offender = prevalence <span class="math inline">\(\times\)</span> frequency <span class="math inline">\(\times\)</span> pop_str</li>
</ul>
<div id="standardizing-and-decomposing-scotlands-reconviction-rate" class="section level2">
<h2>Standardizing and decomposing Scotland’s reconviction rate</h2>
<p>Below, we decompose Scotland’s reconviction rate into the prevalence of reconviction and the age-sex structure of the convicted population.<br />
This is useful because we can then investigate how much changes in the overall reconviction rate are due to fewer people being reconvicted, or due to the changing age-sex mix of the convicted population (so, if younger people tend to have higher reconviction rates, but are becoming more frequently <a href="http://scottishjusticematters.com/wp-content/uploads/Shrinking-YJ-population-SJM_5-1_April2017-18.pdf">diverted from prosecution</a>, then younger groups will begin to make up a smaller proportion of the convicted population, and so the overall rate at which the population is reconvicted will go down (even if the rates at which different sub-groups are reconvicted do not).</p>
<p>The code below decomposes the Scotland’s reconviction rates for 2004 to 2007 into prevalence and population structure. We focus initially on this small period of time simply because the output becomes cumbersome as the the number of populations increases.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create our decomposition factors</span>
reconv &lt;-<span class="st"> </span>
<span class="st">  </span>reconv <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">prevalence =</span> reconvicted<span class="op">/</span>offenders,
    <span class="dt">frequency =</span> reconvictions<span class="op">/</span>reconvicted, <span class="co">#not used here</span>
    <span class="dt">pop_str =</span> offenders<span class="op">/</span>convicted_population
  ) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="dv">2004</span><span class="op">:</span><span class="dv">2007</span>) <span class="co">#the output is pretty cumbersome, so lets keep it at 4 years for now</span>

<span class="co">#standardize and decompose!</span>
reconv_DG &lt;-<span class="st"> </span><span class="kw">DasGupt_Npop</span>(<span class="dt">df=</span>reconv,
                          <span class="dt">pop=</span>year,prevalence, pop_str,
                          <span class="dt">id_vars=</span><span class="kw">c</span>(Age,Gender),<span class="dt">ratefunction=</span><span class="st">&quot;prevalence*pop_str&quot;</span>)
                          <span class="co"># the default ratefunction calculates rate as the product of all specified factors</span>
                          <span class="co"># in theory this function works with any function you like.</span></code></pre></div>
<p>As shown below, the DasGupt_Npop() function returns a tibble with a column for the P-<span class="math inline">\(\alpha\)</span> adjusted rates in each population. The ‘factor’ column specifies <span class="math inline">\(\alpha\)</span>.</p>
<p>It also specifies the standardized decomposition <span class="math inline">\(\alpha\)</span> effects for each pairwise comparison of populations (again, the ‘factor’ column specifies <span class="math inline">\(\alpha\)</span>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(reconv_DG)</code></pre></div>
<pre><code>## Classes 'tbl_df', 'tbl' and 'data.frame':    20 obs. of  19 variables:
##  $ Age          : chr  &quot;21 to 25&quot; &quot;26 to 30&quot; &quot;31 to 40&quot; &quot;over 40&quot; ...
##  $ Gender       : chr  &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; &quot;Female&quot; ...
##  $ pop2004      : num  0.01121 0.0087 0.01086 0.00484 0.00904 ...
##  $ pop2005      : num  0.00993 0.00831 0.01045 0.00439 0.00907 ...
##  $ pop2006      : num  0.01015 0.00848 0.01105 0.00481 0.00936 ...
##  $ pop2007      : num  0.00981 0.00803 0.01095 0.00478 0.00914 ...
##  $ diff2004_2005: num  -1.28e-03 -3.87e-04 -4.10e-04 -4.49e-04 3.46e-05 ...
##  $ diff2004_2006: num  -1.06e-03 -2.17e-04 1.83e-04 -3.26e-05 3.29e-04 ...
##  $ diff2004_2007: num  -1.40e-03 -6.62e-04 8.98e-05 -6.56e-05 1.05e-04 ...
##  $ diff2005_2006: num  0.000226 0.000169 0.000593 0.000417 0.000294 ...
##  $ diff2005_2007: num  -1.16e-04 -2.75e-04 5.00e-04 3.84e-04 7.06e-05 ...
##  $ diff2006_2007: num  -3.42e-04 -4.44e-04 -9.36e-05 -3.30e-05 -2.24e-04 ...
##  $ diff2005_2004: num  1.28e-03 3.87e-04 4.10e-04 4.49e-04 -3.46e-05 ...
##  $ diff2006_2004: num  1.06e-03 2.17e-04 -1.83e-04 3.26e-05 -3.29e-04 ...
##  $ diff2007_2004: num  1.40e-03 6.62e-04 -8.98e-05 6.56e-05 -1.05e-04 ...
##  $ diff2006_2005: num  -0.000226 -0.000169 -0.000593 -0.000417 -0.000294 ...
##  $ diff2007_2005: num  1.16e-04 2.75e-04 -5.00e-04 -3.84e-04 -7.06e-05 ...
##  $ diff2007_2006: num  3.42e-04 4.44e-04 9.36e-05 3.30e-05 2.24e-04 ...
##  $ factor       : chr  &quot;prevalence&quot; &quot;prevalence&quot; &quot;prevalence&quot; &quot;prevalence&quot; ...</code></pre>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>As set out in his 1993 book <em><a href="https://babel.hathitrust.org/cgi/pt?id=osu.32437011198450">Standardization and decomposition of rates: A user’s manual</a></em>.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>As an avid R user, the reliance upon the term ‘factor’ here will get annoying. Sorry. Just remember it’s ‘factor’ in the sense akin to CFA/PCA.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Importantly, this analysis is not causal as the different decomposition effects identified by standardization and decomposition may themselves be the products of one (or more) variables not included in the analysis (Das Gupta 1993:4).<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>When we’re disaggregating by population structure, this factor remains implicitly present with a value of 1 (thereby having no impact).<a href="#fnref4">↩</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
